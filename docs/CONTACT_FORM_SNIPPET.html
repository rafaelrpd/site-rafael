<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário de Contato - Exemplo</title>

    <!-- Cloudflare Turnstile Widget -->
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>

    <style>
        /* Estilos mínimos de exemplo - adapte ao seu design */
        .contact-form {
            max-width: 500px;
            margin: 2rem auto;
            padding: 2rem;
            font-family: system-ui, -apple-system, sans-serif;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1rem;
            box-sizing: border-box;
        }

        .form-group textarea {
            min-height: 150px;
            resize: vertical;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: 2px solid #0066cc;
            border-color: transparent;
        }

        .submit-btn {
            width: 100%;
            padding: 1rem;
            background: #0066cc;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .submit-btn:hover:not(:disabled) {
            background: #0052a3;
        }

        .submit-btn:disabled {
            background: #999;
            cursor: not-allowed;
        }

        .message {
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            display: none;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            display: block;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            display: block;
        }

        /* Turnstile widget styling */
        .cf-turnstile {
            margin-bottom: 1.5rem;
        }
    </style>
</head>

<body>

    <form id="contactForm" class="contact-form">
        <h2>Entre em Contato</h2>

        <div id="formMessage" class="message"></div>

        <div class="form-group">
            <label for="name">Nome *</label>
            <input type="text" id="name" name="name" required minlength="1" maxlength="100" placeholder="Seu nome">
        </div>

        <div class="form-group">
            <label for="email">Email *</label>
            <input type="email" id="email" name="email" required maxlength="254" placeholder="seu@email.com">
        </div>

        <div class="form-group">
            <label for="subject">Assunto</label>
            <input type="text" id="subject" name="subject" maxlength="120" placeholder="Assunto da mensagem (opcional)">
        </div>

        <div class="form-group">
            <label for="message">Mensagem *</label>
            <textarea id="message" name="message" required minlength="1" maxlength="4000"
                placeholder="Sua mensagem..."></textarea>
        </div>

        <!-- Cloudflare Turnstile Widget -->
        <!-- SUBSTITUA <<<TURNSTILE_SITE_KEY>>> PELA SUA SITE KEY -->
        <div class="cf-turnstile" data-sitekey="0x4AAAAAACYSQicu6PsEj5hg" data-callback="onTurnstileSuccess"
            data-expired-callback="onTurnstileExpired" data-error-callback="onTurnstileError"></div>

        <button type="submit" id="submitBtn" class="submit-btn" disabled>
            Enviar Mensagem
        </button>
    </form>

    <script>
        // Estado do Turnstile
        let turnstileToken = null;

        // Callbacks do Turnstile
        function onTurnstileSuccess(token) {
            turnstileToken = token;
            document.getElementById('submitBtn').disabled = false;
        }

        function onTurnstileExpired() {
            turnstileToken = null;
            document.getElementById('submitBtn').disabled = true;
        }

        function onTurnstileError() {
            turnstileToken = null;
            document.getElementById('submitBtn').disabled = true;
            showMessage('Erro ao carregar verificação. Recarregue a página.', 'error');
        }

        // Exibir mensagem
        function showMessage(text, type) {
            const messageEl = document.getElementById('formMessage');
            messageEl.textContent = text;
            messageEl.className = 'message ' + type;
        }

        // Esconder mensagem
        function hideMessage() {
            const messageEl = document.getElementById('formMessage');
            messageEl.className = 'message';
        }

        // Handler do formulário
        document.getElementById('contactForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            hideMessage();

            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.textContent;

            // Validar token Turnstile
            if (!turnstileToken) {
                showMessage('Por favor, complete a verificação anti-spam.', 'error');
                return;
            }

            // Coletar dados
            const formData = {
                name: document.getElementById('name').value.trim(),
                email: document.getElementById('email').value.trim(),
                subject: document.getElementById('subject').value.trim() || undefined,
                message: document.getElementById('message').value.trim(),
                turnstileToken: turnstileToken
            };

            // Validações básicas
            if (!formData.name || formData.name.length < 1 || formData.name.length > 100) {
                showMessage('Nome inválido (1-100 caracteres).', 'error');
                return;
            }

            if (!formData.email || !formData.email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)) {
                showMessage('Email inválido.', 'error');
                return;
            }

            if (!formData.message || formData.message.length < 1 || formData.message.length > 4000) {
                showMessage('Mensagem inválida (1-4000 caracteres).', 'error');
                return;
            }

            // Desabilitar botão
            submitBtn.disabled = true;
            submitBtn.textContent = 'Enviando...';

            try {
                const response = await fetch('https://rafaeldias.net/api/contact', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (response.ok && result.ok) {
                    showMessage('Mensagem enviada com sucesso! Responderei em breve.', 'success');
                    // Limpar formulário
                    document.getElementById('contactForm').reset();
                    // Resetar Turnstile
                    if (window.turnstile) {
                        turnstile.reset();
                    }
                    turnstileToken = null;
                } else {
                    showMessage(result.error || 'Erro ao enviar mensagem. Tente novamente.', 'error');
                }
            } catch (error) {
                console.error('Erro:', error);
                showMessage('Erro de conexão. Verifique sua internet e tente novamente.', 'error');
            } finally {
                submitBtn.disabled = !turnstileToken;
                submitBtn.textContent = originalText;
            }
        });
    </script>

</body>

</html>

<!--
================================================================================
INSTRUÇÕES DE USO
================================================================================

1. ANTES DE USAR:
   - Substitua <<<TURNSTILE_SITE_KEY>>> pela sua Site Key do Turnstile
   - Verifique que o worker está deployado em rafaeldias.net/api/contact

2. INTEGRAÇÃO NO SITE:
   - Copie o HTML do <form> para sua página
   - Copie o <script> do Turnstile no <head>
   - Copie o JavaScript para o final do body
   - Adapte os estilos CSS ao seu design

3. PAYLOAD ESPERADO PELO WORKER:
   {
     "name": "string (1-100 chars)",
     "email": "string (email válido)",
     "subject": "string (0-120 chars, opcional)",
     "message": "string (1-4000 chars)",
     "turnstileToken": "string (token do widget)"
   }

4. RESPOSTAS DO WORKER:
   - 200 { "ok": true } - Sucesso
   - 400 { "error": "..." } - Erro de validação
   - 403 { "error": "Origin não permitida" } - CORS
   - 429 { "error": "Muitas requisições..." } - Rate limit

================================================================================
-->